<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Wardrobe Assistant</title>

  <!-- Fonts & icons -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Your redesigned CSS (replace your current style.css with the CSS below) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- Keep your weather script if you have one -->
  <script defer src="{{ url_for('static', filename='js/weather_recommendation.js') }}"></script>
</head>
<body class="app-body">

  <!-- NAVBAR -->
  <header class="navbar">
    <div class="nav-left">
      <div class="brand">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="logo" class="brand-logo" onerror="this.style.display='none'">
        <div class="brand-text">
          <div class="brand-title">Smart Wardrobe Assistant</div>
          <div class="brand-sub">AI-powered outfit planner</div>
        </div>
      </div>
    </div>

    <nav class="nav-links" aria-label="Main navigation">
      {% if user %}
        <a href="{{ url_for('index') }}" class="nav-link"><i class="fa-solid fa-house"></i> Home</a>
        <a href="{{ url_for('recommend') }}" class="nav-link"><i class="fa-solid fa-lightbulb"></i> Recommendations</a>
        <a href="{{ url_for('wardrobe') }}" class="nav-link"><i class="fa-solid fa-shirt"></i> My Wardrobe</a>
        <a href="{{ url_for('logout') }}" class="nav-link cta"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
      {% else %}
        <a href="{{ url_for('login') }}" class="nav-link cta"><i class="fa-solid fa-right-to-bracket"></i> Login / Register</a>
      {% endif %}
    </nav>
  </header>

  <main class="container">

    <!-- HERO -->
    <section class="hero">
      <div>
        <h1>Welcome back{% if user %}, {{ user.name | default('') }}{% endif %} ‚ú®</h1>
        <p class="hero-sub">Upload your clothing, generate outfits, and get weather-smart recommendations.</p>
      </div>
      <!-- <div class="hero-actions"> -->
        <!-- <button class="btn ghost" onclick="document.getElementById('uploadInput').click();">
          <i class="fa-solid fa-upload"></i> Upload Item
        </button> -->
        <!-- <button class="btn" onclick="generateOutfit()"> -->
          <!-- <i class="fa-solid fa-magic"></i> Generate Outfit -->
        </button>
      </div>
    </section>


     <hr class="divider big">

    <!-- UPLOAD + PREVIEW -->
    <section class="grid grid-2 upload-section">
      <div class="card upload-card">
        <div class="card-header">
          <h3>üì§ Upload New Clothing Item</h3>
        </div>

        <div class="card-body">
          <form id="uploadForm" class="upload-form" enctype="multipart/form-data">
            <label for="uploadInput" class="dropzone" id="dropzone">
              <input id="uploadInput" type="file" name="file" accept="image/*" required hidden>
              <div class="drop-inner">
                <i class="fa-solid fa-cloud-arrow-up fa-2x"></i>
                <p class="muted">Drag & drop an image here, or click to browse</p>
                <small class="muted">PNG, JPG, JPEG ‚Äî max 10MB</small>
              </div>
            </label>

            <div class="form-actions">
              <button type="submit" class="btn">Upload</button>
            </div>
          </form>

          <div id="uploadResult" class="result-panel visually-hidden" aria-live="polite"></div>
        </div>
      </div>

      <div class="card preview-card">
        <div class="card-header">
          <h3>Uploaded Item</h3>
        </div>
        <div class="card-body" id="previewArea">
          <div class="placeholder">
            <i class="fa-solid fa-shirt"></i>
            <p class="muted">No item uploaded yet</p>
          </div>
        </div>
      </div>
    </section>

    <!-- WEATHER + RECOMMENDATIONS (only visible when logged in) -->
    {% if user %}
   <section class="weather-recs">

    <!-- WEATHER SECTION -->
    <div class="card weather-card" id="weather-info">
        <div class="card-header">
            <h3>üå§Ô∏è Today‚Äôs Weather</h3>
        </div>
        <div class="card-body weather-body">
            <div class="loading">Loading weather...</div>
        </div>
    </div>

    <!-- TWO COLUMN CARD LAYOUT -->
    <div class="two-col-section">

        <!-- LEFT ‚Äî Recommended Now -->
        <div class="card recs-card">
            <div class="card-header">
                <h3>Recommended Now</h3>
            </div>
            <div class="card-body">
                <div id="weather-section"></div>
            </div>
        </div>

        <!-- RIGHT ‚Äî Occasion-Based Outfits -->
        <div class="card recs-card">
            <div class="card-header">
                <h3>üéØ Occasion-Based Outfits</h3>
            </div>
            <div class="card-body">
                <div id="occasion-section"></div>
            </div>
        </div>

    </div>

</section>

    {% endif %}

   

    <!-- OUTFIT DISPLAY -->
    <section class="card outfit-card" id="outfitCard" style="display:none;">
      <div class="card-header">
        <h3>‚ú® Recommended Outfit</h3>
      </div>
      <div class="card-body" id="outfit"></div>
    </section>

    <footer class="app-footer">
      <small>Built with ‚ù§Ô∏è ‚Äî Smart Wardrobe Assistant</small>
    </footer>
  </main>

  <!-- JS: upload handling and generateOutfit (keeps same backend routes) -->
  <script>
  // --- Drag & drop UX ---
  const dropzone = document.getElementById('dropzone');
  const fileInput = document.getElementById('uploadInput');
  const uploadResult = document.getElementById('uploadResult');
  const previewArea = document.getElementById('previewArea');

  ;['dragenter','dragover','dragleave','drop'].forEach(evt => {
    dropzone.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
    });
  });

  dropzone.addEventListener('dragover', () => dropzone.classList.add('dragover'));
  dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
  dropzone.addEventListener('drop', (e) => {
    dropzone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if(files && files[0]) fileInput.files = files;
    // show preview
    showPreview(files[0]);
  });

  fileInput.addEventListener('change', (e) => {
    const f = e.target.files[0];
    if(f) showPreview(f);
  });

  function showPreview(file) {
    if(!file) return;
    const url = URL.createObjectURL(file);
    previewArea.innerHTML = `
      <div class="preview-inner">
        <img src="${url}" alt="preview" class="preview-img"/>
        <div class="preview-meta">
          <p class="small"><strong>${file.name}</strong></p>
          <p class="muted small">${Math.round(file.size/1024)} KB</p>
        </div>
      </div>
    `;
  }

  // --- Upload form submit ---
  document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const fd = new FormData(form);
    const submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Uploading...';

    try {
      const res = await fetch('/upload', { method: 'POST', body: fd });
      const data = await res.json();

      if(data.error){
        uploadResult.classList.remove('visually-hidden');
        uploadResult.innerHTML = `<p class="error">${data.error}</p>`;
      } else {
        uploadResult.classList.remove('visually-hidden');
        uploadResult.innerHTML = `
          <div class="upload-preview-row">
            <img src="${data.file_url}" alt="uploaded" class="preview-img-large" />
            <div>
              <p><strong>Subtype:</strong> ${data.subtype || '‚Äî'}</p>
              <p><strong>Info:</strong> ${data.info || '‚Äî'}</p>
              <p><strong>Season:</strong> ${data.season || '‚Äî'}</p>
              <p><strong>Occasion:</strong> ${data.occasion || '‚Äî'}</p>
            </div>
          </div>
        `;
        // Populate the outfit preview area with the uploaded image (if not already)
        previewArea.innerHTML = `<div class="preview-inner"><img src="${data.file_url}" alt="uploaded" class="preview-img"/></div>`;
      }
    } catch(err) {
      uploadResult.classList.remove('visually-hidden');
      uploadResult.innerHTML = `<p class="error">Upload failed. Try again.</p>`;
      console.error(err);
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Upload';
    }
  });

  // --- Generate Outfit (keeps same /recommend API) ---
  async function generateOutfit(){
    try {
      const res = await fetch('/recommend');
      const data = await res.json();

      const outfitCard = document.getElementById('outfitCard');
      const outfitDiv = document.getElementById('outfit');
      outfitCard.style.display = 'block';

      if(data.error){
        outfitDiv.innerHTML = `<p class="error">${data.error}</p>`;
        return;
      }

      // build images (top, bottom, shoe) gracefully
      const imgs = ['top','bottom','shoe'].map(k => data[k]).filter(Boolean);
      const imgsHtml = imgs.length ? imgs.map(u => `<img src="${u}" alt="${u}" class="outfit-img">`).join('') : '<p class="muted">No images available</p>';

      outfitDiv.innerHTML = `
        <div class="outfit-meta">
          <p><strong>Occasion:</strong> ${data.occasion || 'N/A'}</p>
          <p><strong>Season:</strong> ${data.season || 'N/A'}</p>
        </div>
        <div class="outfit-grid">${imgsHtml}</div>
      `;
    } catch(err){
      console.error(err);
      document.getElementById('outfit').innerHTML = `<p class="error">Could not fetch recommendations.</p>`;
    }
  }
  </script>
</body>
</html>
